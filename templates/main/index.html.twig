{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}
    <div>
        <div class="container">
            <div class="row mt-5 mb-3">
                <h3 class="offset-5 col-2">Accueil</h3>


                <div class="offset-2 col-3">
                    <h4>Date du jour : {{ "now"|date("d/m/Y") }}  </h4>
                    <h4>Participant: {{ app.user.pseudo }}</h4>
                    <br>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <h3>Filtrer les sites</h3>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <form class="col-auto">
                        {{ form_start(form) }}
                        {{ form_widget(form) }}
                        {{ form_end(form) }}
                    </form>


                    <form class="d-flex">
                        <label for="rechercher">Le nom de la sortie contient: </label>
                        <input id="rechercher" class="form-control me-2 rechercher" onkeyup="fonctionRechercheFiltre()"
                               type="search" placeholder="Rechercher"
                               aria-label="Search">
                    </form>

                    <form class="d-flex">
                        <strong>Entre:</strong>
                        <input id="date" class="form-control me-2 " type="date" placeholder="Date">
                        <strong>Et:</strong>
                        <input id="date" class="form-control me-2 " type="date" placeholder="Date">
                    </form>
                </div>

                <div class="col-6">
                    <form class="col-auto">

                        {{ form_start(form2, {attr: {class: 'filter js-filter-form'}}) }}

                        <div class="row">
                            {{ form_row(form2.q) }}
                            <div class="col-md-6">
                                {{ form_row(form2.sortie1) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form2.sortie2) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form2.sortie3) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form2.sortie4) }}
                            </div>
                        </div>


                        <button type="submit" class="btn btn-primary w-100">Filtrer</button>

                        {{ form_end(form2) }}


                    </form>
                </div>
            </div>
            <div class="mt-3">
                {% for message in app.flashes('success') %}
                    <div class="alert alert-success text-center">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>


            <table id="Table" class="table table-striped mt-5">
                <thead>
                <tr>
                    <th scope="col">Nom de la sortie</th>
                    <th scope="col">Date de la sortie</th>
                    <th scope="col">Clôture</th>
                    <th scope="col">inscrits/places</th>
                    <th scope="col">Etats</th>
                    <th scope="col">Inscrit</th>
                    <th scope="col">Organisateur</th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for sortie in sorties %}
                    {% set ins = null %}
                    <tr>
                        <td>{{ sortie.nom }}</td>
                        <td>{{ sortie.dateHeureDebut|date(" d-m-Y H:i ") }}</td>
                        <td>{{ sortie.dateFinInscription|date(" d-m-Y ") }} </td>
                        <td>{{ sortie.participants|length }}/{{ sortie.nbInscriptionMax }}</td>
                        <td>{{ sortie.etat.libelle }} </td>
                        {% for participant in sortie.participants %}
                            {% if participant.id == app.user.id %}
                                {% set ins = 'x' %}
                            {% elseif participant.id ==null %}
                                {% set ins = null %}
                            {% endif %}
                        {% endfor %}
                        <td>{{ ins }}</td>
                        <td>
                            <a href="{{ path('app_profilParticipant',{id:sortie.organisateur.id}) }}">{{ sortie.organisateur.pseudo }}</a>
                        </td>

                        <td><a href="{{ path('app_sortie_afficher',{id:sortie.id}) }}">
                                <button class="btn btn-primary" type="button" name="id">Afficher</button>
                            </a>
                            {# {% if 'now'|date(" Y-m-d H:i") < sortie.dateHeureDebut|date(" Y-m-d H:i") and sortie.organisateur.id == app.user.id %}
                    <button class="btn btn-primary" type="submit" name="id" value="{{ sortie.id }}">Supprimer</button>
                    {% endif %} #}
                            {% if 'now'|date(" Y-m-d ") < sortie.dateFinInscription|date(" Y-m-d ") and  ins == null and app.user.id != sortie.organisateur.id %}
                                <a href="{{ path('app_sortie_inscription',{id:sortie.id}) }}">
                                    <button class="btn btn-primary" type="button" name="id">Inscription</button>
                                </a>
                            {% endif %}
                            {% if 'now'|date(" Y-m-d ") < sortie.dateHeureDebut|date(" Y-m-d ") and  ins != null and app.user.id != sortie.organisateur.id %}
                                <a href="{{ path('app_sortie_desistement',{id:sortie.id}) }}">
                                    <button class="btn btn-primary" type="button" name="id">Se désister</button>
                                </a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}


                </tbody>
            </table>

            {{ knp_pagination_render(sorties) }}


            <div class="row py-5">
                <div class="col text-center">
                    <a href="{{ path('app_sortie_ajout') }}">
                        <button class="btn btn-primary">Créer une sortie</button>
                    </a>
                </div>
            </div>

        </div>
    </div>
    <script>
        function fonctionRechercheFiltre() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("rechercher");
            filter = input.value.toUpperCase();
            table = document.getElementById("Table");
            tr = table.getElementsByTagName("tr");
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
    </script>
{% endblock %}
